import XCTest

class XcodeProjectBuilderTests: XCTestCase {
    func testFullModuleParser() {
        let outputData = loadFile("XcodeOutput", ofType: "txt")
        let output = String(data: outputData, encoding: .utf8)!
        let modules = XcodeProjectBuilder(projectToBuild: "", schemeToBuild: "", modulesToIgnore: [], filesToIgnore: []).parseModulesFrom(xcodeBuildOutput: output)
        let testModule = Module(name: "test", sourceFiles: [File(filePath: "/Users/bruno.rocha/Desktop/test/test/ViewController.swift"), File(filePath: "/Users/bruno.rocha/Desktop/test/test/AppDelegate.swift")], xibFiles: [File(filePath: "/Users/bruno.rocha/Desktop/test/test/BLABLA.xib"), File(filePath: "/Users/bruno.rocha/Desktop/test/test/Base.lproj/LaunchScreen.storyboard"), File(filePath: "/Users/bruno.rocha/Desktop/test/test/Base.lproj/Main.storyboard")], plists: [File(filePath: "/Users/bruno.rocha/Desktop/test/test/Info.plist")], compilerArguments: ["-module-name", "test", "-Onone", "-enforce-exclusivity=checked", "-DDEBUG", "-D", "COCOAPODS", "-sdk", "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.4.sdk", "-target", "arm64-apple-ios11.4", "-g", "-module-cache-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/ModuleCache.noindex", "-Xfrontend", "-serialize-debugging-options", "-embed-bitcode-marker", "-enable-testing", "-index-store-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Index/DataStore", "-swift-version", "4", "-I", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos", "-F", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos", "-F", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos/RapiddoUtils", "-c", "-j8", "/Users/bruno.rocha/Desktop/test/test/ViewController.swift", "/Users/bruno.rocha/Desktop/test/test/AppDelegate.swift", "-emit-module", "-emit-module-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/Objects-normal/arm64/test.swiftmodule", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/swift-overrides.hmap", "-Xcc", "-iquote", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/test-generated-files.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/test-own-target-headers.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/test-all-non-framework-target-headers.hmap", "-Xcc", "-ivfsoverlay", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/all-product-headers.yaml", "-Xcc", "-iquote", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/test-project-headers.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos/include", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/DerivedSources/arm64", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/DerivedSources", "-Xcc", "-DDEBUG=1", "-Xcc", "-DCOCOAPODS=1", "-emit-objc-header", "-emit-objc-header-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/test.build/Debug-iphoneos/test.build/Objects-normal/arm64/test-Swift.h", "-Xcc", "-working-directory/Users/bruno.rocha/Desktop/test", "-D", "DEBUG"])
        let myLibModule = Module(name: "MyLib", sourceFiles: [File(filePath: "/Users/bruno.rocha/Desktop/test/RapiddoUtils/Sources/Classes/Core/Actions+RapiddoUtils.swift")], xibFiles: [File(filePath: "/Users/bruno.rocha/Desktop/test/RapiddoUtils/Sources/Assets/StatusLine.xib")], plists: [File(filePath: "/Users/bruno.rocha/Desktop/test/Pods/Target Support Files/RapiddoUtils/Info.plist")], compilerArguments: ["-module-name", "MyLib", "-Onone", "-enforce-exclusivity=checked", "-DDEBUG", "-D", "COCOAPODS", "-suppress-warnings", "-sdk", "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.4.sdk", "-target", "arm64-apple-ios10.0", "-g", "-module-cache-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/ModuleCache.noindex", "-Xfrontend", "-serialize-debugging-options", "-embed-bitcode-marker", "-enable-testing", "-index-store-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Index/DataStore", "-swift-version", "4", "-I", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos/RapiddoUtils", "-F", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos/RapiddoUtils", "-parse-as-library", "-c", "-j8", "/Users/bruno.rocha/Desktop/test/RapiddoUtils/Sources/Classes/Core/Actions+RapiddoUtils.swift", "-emit-module", "-emit-module-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/Objects-normal/arm64/MyLib.swiftmodule", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/swift-overrides.hmap", "-Xcc", "-iquote", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/MyLib-generated-files.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/MyLib-own-target-headers.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/MyLib-all-non-framework-target-headers.hmap", "-Xcc", "-ivfsoverlay", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/all-product-headers.yaml", "-Xcc", "-iquote", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/MyLib-project-headers.hmap", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Products/Debug-iphoneos/RapiddoUtils/include", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/DerivedSources/arm64", "-Xcc", "-I/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/DerivedSources", "-Xcc", "-DPOD_CONFIGURATION_DEBUG=1", "-Xcc", "-DDEBUG=1", "-Xcc", "-DCOCOAPODS=1", "-emit-objc-header", "-emit-objc-header-path", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/Objects-normal/arm64/MyLib-Swift.h", "-import-underlying-module", "-Xcc", "-ivfsoverlay", "-Xcc", "/Users/bruno.rocha/Library/Developer/Xcode/DerivedData/test-euprrsjlupqerteomiuayoqgzxwj/Build/Intermediates.noindex/Pods.build/Debug-iphoneos/RapiddoUtils.build/unextended-module-overlay.yaml", "-Xcc", "-working-directory/Users/bruno.rocha/Desktop/test/Pods", "-D", "DEBUG"])
        let podsModule = Module(name: "Pods_test", sourceFiles: [], xibFiles: [], plists: [File(filePath: "/Users/bruno.rocha/Desktop/test/Pods/Target Support Files/Pods-test/Info.plist")], compilerArguments: [])
        let expectedModules = [myLibModule, podsModule, testModule]
        XCTAssertEqual(modules, expectedModules)
        let modulesIgnoringMyLib = XcodeProjectBuilder(projectToBuild: "", schemeToBuild: "", modulesToIgnore: ["MyLib", "Pods_test"], filesToIgnore: []).parseModulesFrom(xcodeBuildOutput: output)
        XCTAssertEqual(modulesIgnoringMyLib, [testModule])
    }
}
